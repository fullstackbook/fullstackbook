"use strict";(self.webpackChunkfullstackbook=self.webpackChunkfullstackbook||[]).push([[310],{3905:(t,e,o)=>{o.d(e,{Zo:()=>c,kt:()=>g});var n=o(7294);function a(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function r(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function i(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function s(t,e){if(null==t)return{};var o,n,a=function(t,e){if(null==t)return{};var o,n,a={},r=Object.keys(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||(a[o]=t[o]);return a}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)o=r[n],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(a[o]=t[o])}return a}var p=n.createContext({}),l=function(t){var e=n.useContext(p),o=e;return t&&(o="function"==typeof t?t(e):i(i({},e),t)),o},c=function(t){var e=l(t.components);return n.createElement(p.Provider,{value:e},t.children)},m={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},d=n.forwardRef((function(t,e){var o=t.components,a=t.mdxType,r=t.originalType,p=t.parentName,c=s(t,["components","mdxType","originalType","parentName"]),d=l(o),g=a,u=d["".concat(p,".").concat(g)]||d[g]||m[g]||r;return o?n.createElement(u,i(i({ref:e},c),{},{components:o})):n.createElement(u,i({ref:e},c))}));function g(t,e){var o=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var r=o.length,i=new Array(r);i[0]=d;var s={};for(var p in e)hasOwnProperty.call(e,p)&&(s[p]=e[p]);s.originalType=t,s.mdxType="string"==typeof t?t:a,i[1]=s;for(var l=2;l<r;l++)i[l]=o[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},9937:(t,e,o)=>{o.r(e),o.d(e,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var n=o(7462),a=(o(7294),o(3905));const r={},i="To Do App",s={unversionedId:"backend/springboot/todo",id:"backend/springboot/todo",title:"To Do App",description:"Installation",source:"@site/docs/backend/springboot/todo.md",sourceDirName:"backend/springboot",slug:"/backend/springboot/todo",permalink:"/docs/backend/springboot/todo",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/backend/springboot/todo.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"To Do",permalink:"/docs/backend/nestjs/todo"},next:{title:"To Do",permalink:"/docs/frontend/nextjs/todo"}},p={},l=[{value:"Installation",id:"installation",level:2},{value:"Controller",id:"controller",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Database Migrations",id:"database-migrations",level:2},{value:"ORM",id:"orm",level:2},{value:"Service",id:"service",level:2},{value:"Request/Response",id:"requestresponse",level:2},{value:"Exception Handling",id:"exception-handling",level:2},{value:"CORS",id:"cors",level:2},{value:"Testing",id:"testing",level:2}],c={toc:l};function m(t){let{components:e,...o}=t;return(0,a.kt)("wrapper",(0,n.Z)({},c,o,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"to-do-app"},"To Do App"),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("p",null,"Options to initialize a Spring Boot project:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Use the Spring Initializr at ",(0,a.kt)("a",{parentName:"li",href:"https://start.spring.io/"},"https://start.spring.io/"),"."),(0,a.kt)("li",{parentName:"ul"},"Use IntelliJ Ultimate Edition which has Spring Initializr built in."),(0,a.kt)("li",{parentName:"ul"},"Use the VSCode Extension. ",(0,a.kt)("a",{parentName:"li",href:"https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-spring-initializr"},"https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-spring-initializr"))),(0,a.kt)("p",null,"Dependencies:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Lombok"),(0,a.kt)("li",{parentName:"ul"},"Spring Web"),(0,a.kt)("li",{parentName:"ul"},"Spring Data JPA"),(0,a.kt)("li",{parentName:"ul"},"Liquibase Migration"),(0,a.kt)("li",{parentName:"ul"},"PostgreSQL Driver")),(0,a.kt)("h2",{id:"controller"},"Controller"),(0,a.kt)("p",null,"We start with a simple Hello World. And as a sanity check, we will log out a configuration value, the name of the application."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="AppController.java"',title:'"AppController.java"'},'package com.example.fullstackbooktodospringboot.controller;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\npublic class AppController {\n    Logger logger = LoggerFactory.getLogger(AppController.class);\n\n    @Value("${spring.application.name}")\n    private String name;\n\n    @GetMapping("/")\n    public String getRoot() {\n        logger.info(name);\n        return "Hello World";\n    }\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"LoggerFactory is one way to set up logging."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"@Value")," annotation reads the configuration values from ",(0,a.kt)("inlineCode",{parentName:"p"},"application.properties")," and provides it to the controller.")),(0,a.kt)("p",null,"The controller is the entry point of our API, where we capture HTTP requests and send them off to our services for processing."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDoController.java"',title:'"ToDoController.java"'},'package com.example.fullstackbooktodospringboot.controller;\n\nimport com.example.fullstackbooktodospringboot.dto.CreateToDoDto;\nimport com.example.fullstackbooktodospringboot.dto.ToDoDto;\nimport com.example.fullstackbooktodospringboot.dto.UpdateToDoDto;\nimport com.example.fullstackbooktodospringboot.service.ToDoService;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.*;\n\nimport java.util.List;\nimport java.util.Optional;\n\n@RestController\n@RequestMapping("/todos")\npublic class ToDoController {\n    private ToDoService toDoService;\n\n    public ToDoController (ToDoService toDoService) {\n        this.toDoService = toDoService;\n    }\n\n    @PostMapping("")\n    public ResponseEntity<ToDoDto> createToDo(@RequestBody CreateToDoDto newToDo) {\n        ToDoDto toDoDTO = toDoService.createTodo(newToDo);\n        return new ResponseEntity<>(toDoDTO, HttpStatus.CREATED);\n    }\n\n    @GetMapping("")\n    public List<ToDoDto> getToDos(@RequestParam Optional<Boolean> completed) {\n        if (completed.isPresent()) {\n            return toDoService.getToDos(completed.get());\n        }\n        return toDoService.getToDos();\n    }\n\n    @GetMapping("/{id}")\n    public ToDoDto getToDoById(@PathVariable Long id) {\n        return toDoService.getToDoById(id);\n    }\n\n    @PutMapping("/{id}")\n    public ToDoDto updateToDo(@PathVariable Long id, @RequestBody UpdateToDoDto updateToDo) {\n        return toDoService.updateToDo(id, updateToDo);\n    }\n\n    @DeleteMapping("/{id}")\n    public ResponseEntity deleteToDo(@PathVariable Long id) {\n        toDoService.deleteToDo(id);\n        return new ResponseEntity<>(HttpStatus.OK);\n    }\n}\n\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The ToDoService is injected into this controller via constructor injection."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"@RestController")," is provided by the Spring Web Dependency."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"@RequestMapping"),' scopes all endpoints to the base "/todos" path.'),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"@RequestParam")," reads the query string parameter. ?completed=",(0,a.kt)("inlineCode",{parentName:"p"},"{boolean}"),"."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"@RequestBody")," reads the JSON payload and maps it to the Data Transfer Object (DTO)."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"@PathVariable")," reads the path parameter /todos/",(0,a.kt)("inlineCode",{parentName:"p"},"{id}"),".")),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"Spring Boot provides a mechanism to configure your app. For example, in ",(0,a.kt)("inlineCode",{parentName:"p"},"application.properties"),", we define our application name, database credentials, the database migration config file, and the port to listen on."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-txt",metastring:'title="application.properties"',title:'"application.properties"'},"spring.application.name=${APP_NAME:Full Stack Book To Do}\nspring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/fullstackbook-todo-springboot}\nspring.datasource.username=${DB_USER:postgres}\nspring.datasource.password=${DB_PASSWORD:}\nspring.liquibase.change-log=classpath:db/changelog/changelog.xml\nserver.port=8000\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The format of configuration is:"),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"foo.bar=${ENV_VARIABLE_NAME:default value}")),(0,a.kt)("p",{parentName:"admonition"},"For example:\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"spring.application.name")," configuration has a default value of ",(0,a.kt)("inlineCode",{parentName:"p"},"Full Stack Book To Do"),", but can be overridden by the ",(0,a.kt)("inlineCode",{parentName:"p"},"APP_NAME")," environment variable.")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},'In IntelliJ, the environment variables can be changed by clicking on the "green hammer" icon -> Edit Configurations -> Environment -> Environment Variables.'),(0,a.kt)("p",{parentName:"admonition"},"In VSCode, the environment variables can be changed by using a ",(0,a.kt)("inlineCode",{parentName:"p"},".env"),' file. The file name and path can be changed by going to Run and Debug -> "cog" icon to open ',(0,a.kt)("inlineCode",{parentName:"p"},"launch.json"),".")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Do not check in production secrets, such as api keys and db credentials, into the git repository. Those should be loaded in as environment variables.")),(0,a.kt)("h2",{id:"database-migrations"},"Database Migrations"),(0,a.kt)("p",null,"Most real world projects will use migrations to make incremental schema changes to the database."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml",metastring:'title="changelog.xml"',title:'"changelog.xml"'},'<?xml version="1.0" encoding="UTF-8"?>\n<databaseChangeLog\n        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"\n        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n        xmlns:pro="http://www.liquibase.org/xml/ns/pro"\n        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.4.xsd\n      http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.5.xsd">\n    <includeAll path="db/changelog/*.sql" />\n</databaseChangeLog>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="changelog-1.0.sql"',title:'"changelog-1.0.sql"'},"--liquibase formatted sql\n\n--changeset fullstackbook:1\ncreate table todos (\n  id bigserial primary key,\n  name text\n);\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql",metastring:'title="changelog-2.0.sql"',title:'"changelog-2.0.sql"'},"--liquibase formatted sql\n\n--changeset fullstackbook:2\nalter table todos add column completed boolean not null default false;\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Migrations are run automatically when you start the server."),(0,a.kt)("p",{parentName:"admonition"},"Liquibase supports writing the migrations in an xml format. It has some advantages like rollbacks and being database agnostic, but in order to keep things simple, we opted for raw sql.")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Do not use automatic schema generation since that is also only used in development."),(0,a.kt)("p",{parentName:"admonition"},"It is best to keep development and production as similar as possible, so it is good to start with a production grade migration tool and database.")),(0,a.kt)("h2",{id:"orm"},"ORM"),(0,a.kt)("p",null,"JPA stands for Java Persistence API, a Java specification. Hibernate is an ORM, and an implementation of JPA. ORM stands for Object Relational Mapping."),(0,a.kt)("p",null,"This provides a way for us to map database tables to objects and interact with our database using methods provided by the ORM."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDo.java"',title:'"ToDo.java"'},'package com.example.fullstackbooktodospringboot.model;\n\nimport lombok.Data;\n\nimport javax.persistence.*;\n\n@Entity\n@Data\n@Table(name = "todos")\npublic class ToDo {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    private Long id;\n\n    @Column\n    private String name;\n\n    @Column\n    private Boolean completed;\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@Entity")," annotation is provided by Spring Data JPA. It declares the model."),(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@Data")," annotation is provided by Lombok, and gives us free getters and setters, reducing much boilerplate java code."),(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@Id")," annotation and ",(0,a.kt)("inlineCode",{parentName:"p"},"GeneratedValue")," annotation declares the auto-increment primary key."),(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@Column")," annotation declares a database field mapping.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDoRepository.java"',title:'"ToDoRepository.java"'},"package com.example.fullstackbooktodospringboot.repository;\n\nimport com.example.fullstackbooktodospringboot.model.ToDo;\nimport org.springframework.data.jpa.repository.JpaRepository;\n\nimport java.util.List;\n\npublic interface ToDoRepository extends JpaRepository<ToDo, Long> {\n    List<ToDo> findByCompleted(Boolean completed);\n}\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The JpaRepository class is provided by Spring Data JPA. Note ",(0,a.kt)("inlineCode",{parentName:"p"},"Jpa<ToDo, Long>"),", ToDo is the model we defined above. Long is the type of the primary key id. With this declaration, we now have a way to interact with the database. See ",(0,a.kt)("a",{parentName:"p",href:"https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html"},"https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/JpaRepository.html"),".")),(0,a.kt)("h2",{id:"service"},"Service"),(0,a.kt)("p",null,"Service is the layer between Controller and Repository. It is where the business logic lives. In a typical flow, requests are sent to the service from the controller, the service processes the request by making necessary API calls or database queries, constructing a response in the form of a Data Transfer Object (DTO), and sending it back to the controller."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDoService.java"',title:'"ToDoService.java"'},'package com.example.fullstackbooktodospringboot.service;\n\nimport com.example.fullstackbooktodospringboot.dto.CreateToDoDto;\nimport com.example.fullstackbooktodospringboot.dto.ToDoDto;\nimport com.example.fullstackbooktodospringboot.dto.UpdateToDoDto;\nimport com.example.fullstackbooktodospringboot.exception.ToDoException;\nimport com.example.fullstackbooktodospringboot.model.ToDo;\nimport com.example.fullstackbooktodospringboot.repository.ToDoRepository;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.stereotype.Service;\nimport org.springframework.web.server.ResponseStatusException;\n\nimport java.util.List;\nimport java.util.Optional;\n\n@Service\npublic class ToDoService {\n    private ToDoRepository toDoRepository;\n\n    public ToDoService (ToDoRepository toDoRepository) {\n        this.toDoRepository = toDoRepository;\n    }\n\n    public ToDoDto createTodo(CreateToDoDto createToDoDTO) {\n        ToDo newToDo = new ToDo();\n        newToDo.setName(createToDoDTO.getName());\n        newToDo.setCompleted(createToDoDTO.getCompleted());\n        ToDo toDo = toDoRepository.save(newToDo);\n        return new ToDoDto(toDo);\n    }\n\n    public List<ToDoDto> getToDos() {\n        List<ToDo> toDos = toDoRepository.findAll();\n        return toDos.stream().map(entity -> new ToDoDto(entity)).toList();\n    }\n\n    public List<ToDoDto> getToDos(Boolean completed) {\n        List<ToDo> toDos = toDoRepository.findByCompleted(completed);\n        return toDos.stream().map(entity -> new ToDoDto(entity)).toList();\n    }\n\n    public ToDoDto getToDoById(Long id) {\n        Optional<ToDo> toDo = toDoRepository.findById(id);\n        if (toDo.isPresent()) {\n            return new ToDoDto(toDo.get());\n        } else {\n            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "getToDoById - to do not found");\n        }\n    }\n\n    public ToDoDto updateToDo(Long id, UpdateToDoDto updateToDo) {\n        Optional<ToDo> toDo = toDoRepository.findById(id);\n        if (toDo.isPresent()) {\n            toDo.get().setName(updateToDo.getName());\n            toDo.get().setCompleted(updateToDo.getCompleted());\n            toDoRepository.save(toDo.get());\n            return new ToDoDto(toDo.get());\n        } else {\n            throw new ToDoException(404, "updateToDo - to do not found");\n        }\n    }\n\n    public void deleteToDo(Long id) {\n        Optional<ToDo> toDo = toDoRepository.findById(id);\n        if (toDo.isPresent()) {\n            toDoRepository.delete(toDo.get());\n        } else {\n            throw new RuntimeException("deleteToDo - to do not found");\n        }\n    }\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@Service")," annotation is functionally the same as ",(0,a.kt)("inlineCode",{parentName:"p"},"@Component")," in that they are both included in Spring's component scan and used to declare an injectable object. The only difference is in the semantic meaning of service and component. Service indicates a place that holds business logic, while component is more generic."),(0,a.kt)("p",{parentName:"admonition"},"The response DTOs, also considered Plain Old Java Objects (POJOs), are converted into JSON under the hood, by a library called Jackson. Using DTOs gives us flexibility in constructing our JSON API.")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Three different types of exceptions were used in this example to demonstrate how to handle multiple exception types. In a real project, you'll probably want to pick one style and stick to it."),(0,a.kt)("p",{parentName:"admonition"},"There are multiple schools of thought as to the best way to handle exceptions. Some prefer to not include HTTP exceptions in the service layer. And others think it is ok since it keeps thing much simpler.")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"If all you're doing is building a REST API, then it's probably fine to throw the ResponseStatusException at the service layer.")),(0,a.kt)("h2",{id:"requestresponse"},"Request/Response"),(0,a.kt)("p",null,"Data Transfer Objects (DTO), are used for defining request and response object structure. Sometimes they are passed around the code for other reasons, but mostly used for requests and responses."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="CreateToDoDto"',title:'"CreateToDoDto"'},"package com.example.fullstackbooktodospringboot.dto;\n\nimport lombok.Data;\n\n@Data\npublic class CreateToDoDto {\n    private String name;\n    private Boolean completed;\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ErrorDto"',title:'"ErrorDto"'},"package com.example.fullstackbooktodospringboot.dto;\n\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\n\n@Data\n@AllArgsConstructor\npublic class ErrorDto {\n    private String msg;\n}\n\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDoDto"',title:'"ToDoDto"'},"package com.example.fullstackbooktodospringboot.dto;\n\nimport com.example.fullstackbooktodospringboot.model.ToDo;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\n\n@Data\n@AllArgsConstructor\npublic class ToDoDto {\n    private Long id;\n    private String name;\n    private Boolean completed;\n\n    public ToDoDto(ToDo entity) {\n        this.id = entity.getId();\n        this.name = entity.getName();\n        this.completed = entity.getCompleted();\n    }\n}\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The constructor allows us to map an entity to the DTO. Another way to do this is to create a mapper class or using a mapping library like MapStruct."),(0,a.kt)("p",{parentName:"admonition"},"For simplicity, we will use a constructor.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="UpdateToDoDto"',title:'"UpdateToDoDto"'},"package com.example.fullstackbooktodospringboot.dto;\n\nimport lombok.Data;\n\n@Data\npublic class UpdateToDoDto {\n    private String name;\n    private Boolean completed;\n}\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"We leverage Lombok's ",(0,a.kt)("inlineCode",{parentName:"p"},"@Data")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"@AllArgsConstructor")," to reduce much of the boilerplate.")),(0,a.kt)("h2",{id:"exception-handling"},"Exception Handling"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="GlobalControllerExceptionHandler.java"',title:'"GlobalControllerExceptionHandler.java"'},'package com.example.fullstackbooktodospringboot.exception;\n\nimport com.example.fullstackbooktodospringboot.dto.ErrorDto;\nimport lombok.extern.log4j.Log4j2;\nimport org.springframework.http.HttpStatus;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.ControllerAdvice;\nimport org.springframework.web.bind.annotation.ExceptionHandler;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.server.ResponseStatusException;\n\n@ControllerAdvice(annotations = RestController.class)\n@Log4j2\nclass GlobalControllerExceptionHandler {\n    @ExceptionHandler(ResponseStatusException.class)\n    public ResponseEntity<ErrorDto> handleResponseStatusException(ResponseStatusException ex) {\n        log.error("response status exception", ex);\n        ErrorDto errorDto = new ErrorDto(ex.getMessage());\n        return new ResponseEntity<>(errorDto, ex.getStatus());\n    }\n\n    @ExceptionHandler(ToDoException.class)\n    public ResponseEntity<ErrorDto> handleToDoException(ToDoException ex) {\n        log.error("todo custom exception", ex);\n        ErrorDto errorDto = new ErrorDto(ex.getMessage());\n        HttpStatus httpStatus = HttpStatus.resolve(ex.getStatus());\n        return new ResponseEntity<>(errorDto, httpStatus);\n    }\n\n    @ExceptionHandler(RuntimeException.class)\n    public ResponseEntity<ErrorDto> handleRuntimeException(RuntimeException ex) {\n        log.error("internal server error", ex);\n        ErrorDto errorDto = new ErrorDto("internal server error");\n        return new ResponseEntity<>(errorDto, HttpStatus.INTERNAL_SERVER_ERROR);\n    }\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@ControllerAdvice")," annotation in the code above declares a global exception handler for the RestController class."),(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@ExceptionHandler")," annotation is used to declare a handler for each type of exception we want to provide custom handling logic for. For example, logging and returning custom responses."),(0,a.kt)("p",{parentName:"admonition"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@Log4j2")," annotation is provided by lombok and a shorthand for creating a logger object made available to the class as ",(0,a.kt)("inlineCode",{parentName:"p"},"log"),".")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDoException"',title:'"ToDoException"'},"package com.example.fullstackbooktodospringboot.exception;\n\npublic class ToDoException extends RuntimeException {\n    private int status;\n\n    public ToDoException(int status, String message) {\n        super(message);\n        this.status = status;\n    }\n\n    public int getStatus() {\n        return status;\n    }\n}\n")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"A custom exception is probably useful if you have specific exception handling requirements.")),(0,a.kt)("h2",{id:"cors"},"CORS"),(0,a.kt)("p",null,"In order to receive traffic from other domains on the browser, we will have to include the URL in the CORS configuration."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="FullstackbookTodoSpringbootApplication.java"',title:'"FullstackbookTodoSpringbootApplication.java"'},'package com.example.fullstackbooktodospringboot;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.web.servlet.config.annotation.CorsRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@SpringBootApplication\npublic class FullstackbookTodoSpringbootApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(FullstackbookTodoSpringbootApplication.class, args);\n    }\n\n    @Bean\n    public WebMvcConfigurer corsConfigurer() {\n        return new WebMvcConfigurer() {\n            @Override\n            public void addCorsMappings(CorsRegistry registry) {\n                registry.addMapping("/**").allowedMethods("GET", "PUT", "POST", "DELETE").allowedOrigins("http://localhost:3000");\n            }\n        };\n    }\n\n}\n\n')),(0,a.kt)("h2",{id:"testing"},"Testing"),(0,a.kt)("p",null,"Spring Boot provides support for unit testing with MockMvc and MockBean."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="AppControllerTest.java"',title:'"AppControllerTest.java"'},'package com.example.fullstackbooktodospringboot.controller;\n\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.web.servlet.MockMvc;\n\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\nimport static org.hamcrest.CoreMatchers.containsString;\n\n@SpringBootTest\n@AutoConfigureMockMvc\npublic class AppControllerTest {\n\n    @Autowired\n    private MockMvc mockMvc;\n\n    @Test\n    public void getRoot() throws Exception {\n        mockMvc.perform(get("/"))\n                .andExpect(status().isOk()).andExpect(content().string(containsString("Hello World")));\n    }\n\n}\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"In the AppControllerTest, we are making a request to the root endpoint and checking the content of the response."),(0,a.kt)("p",{parentName:"admonition"},"We are using the ",(0,a.kt)("inlineCode",{parentName:"p"},"@Autowired")," annotation to inject MockMvc, so that we can perform the request."),(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("inlineCode",{parentName:"p"},"@Test")," declares a unit test.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDoControllerTest.java"',title:'"ToDoControllerTest.java"'},'package com.example.fullstackbooktodospringboot.controller;\n\nimport com.example.fullstackbooktodospringboot.dto.ToDoDto;\nimport com.example.fullstackbooktodospringboot.service.ToDoService;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.boot.test.mock.mockito.MockBean;\nimport org.springframework.test.web.servlet.MockMvc;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport static org.hamcrest.Matchers.hasSize;\nimport static org.hamcrest.Matchers.is;\nimport static org.mockito.Mockito.when;\nimport static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\nimport static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n\n@SpringBootTest\n@AutoConfigureMockMvc\npublic class ToDoControllerTest {\n\n    @Autowired\n    private MockMvc mockMvc;\n\n    @MockBean\n    private ToDoService toDoService;\n\n    @Test\n    public void getToDosShouldReturnTodos() throws Exception {\n        List<ToDoDto> todos = new ArrayList<>();\n        ToDoDto todoDto = new ToDoDto(1L, "write unit tests", false);\n        todos.add(todoDto);\n        when(toDoService.getToDos()).thenReturn(todos);\n        mockMvc.perform(get("/todos"))\n                .andExpect(status().isOk())\n                .andExpect(jsonPath("$", hasSize(1)))\n                .andExpect(jsonPath("$[0].name", is(todoDto.getName())));\n    }\n}\n\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"We are mocking out the ",(0,a.kt)("inlineCode",{parentName:"p"},"toDoService.getToDos()")," method and providing our own return value. This allows us to test the controller in isolation.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="ToDoServiceTest.java"',title:'"ToDoServiceTest.java"'},'package com.example.fullstackbooktodospringboot.service;\n\nimport com.example.fullstackbooktodospringboot.dto.ToDoDto;\nimport com.example.fullstackbooktodospringboot.model.ToDo;\nimport com.example.fullstackbooktodospringboot.repository.ToDoRepository;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.boot.test.mock.mockito.MockBean;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport static org.mockito.Mockito.when;\nimport static org.assertj.core.api.Assertions.assertThat;\n\n@SpringBootTest\n@AutoConfigureMockMvc\npublic class ToDoServiceTest {\n\n    @Autowired\n    private ToDoService toDoService;\n\n    @MockBean\n    private ToDoRepository toDoRepository;\n\n    @Test\n    public void getToDosShouldReturnTodos() throws Exception {\n        List<ToDo> todos = new ArrayList<>();\n        ToDo todo = new ToDo();\n        todo.setId(1L);\n        todo.setName("write unit tests");\n        todo.setCompleted(false);\n        todos.add(todo);\n        when(toDoRepository.findAll()).thenReturn(todos);\n        List<ToDoDto> todoDtoList = toDoService.getToDos();\n        assertThat(todoDtoList).hasSize(1);\n    }\n}\n\n')),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"In ToDoServiceTest, we are the ",(0,a.kt)("inlineCode",{parentName:"p"},"@MockBean")," annotation to mock out the ",(0,a.kt)("inlineCode",{parentName:"p"},"toDoRepository.findAll()")," method, so that we can test the service in isolation.")))}m.isMDXComponent=!0}}]);